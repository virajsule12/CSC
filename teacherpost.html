<html>
  <head>
    <title>Simple login</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.3/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
         
        var defaultVal=''
        var initialCode=''

        function clickedClasses(){
        window.location.href = "http://virajsule.me/classlist.html";
      }

      function clickedPost(){
        window.location.href = "http://virajsule.me/teacherpost.html";
      }

      function clickedCreate(){
        window.location.href = "http://virajsule.me/createclass.html";
      }

      function clickedLogout(){
        window.location.href = "http://virajsule.me/index.html";
      }

        function setDefault(){
            defaultVal = editor.getValue();
        }
        
        function getTableData(row,col,table) {
            var tbl = document.getElementById(table);      
            var objCells = tbl.rows.item(row).cells;
            var value = objCells.item(col).innerHTML;
            return value;
        
        }

        function changeTableData(val,row,col,table){
            var tbl = document.getElementById(table);
            var objCells = tbl.rows.item(row).cells;
            objCells.item(col).innerHTML = val
        }

        function clearTable(table){
            var tbl = document.getElementById(table);
            for (i = 0; i < tbl.rows.length; i++) {
                var objCells = tbl.rows.item(i).cells;
                for (var j = 0; j < objCells.length; j++) {
                    objCells.item(j).innerHTML = ""
                }
            }
        }
        
        function setEditable(table){
            var tbl = document.getElementById(table);
            for (i = 0; i < tbl.rows.length; i++) {
                var objCells = tbl.rows.item(i).cells;
                for (var j = 1; j < objCells.length; j++) {
                    objCells.item(j).setAttribute("contenteditable", true)
                }
            }
            for (i = 0; i < tbl.rows.length; i++) {
                var objCells = tbl.rows.item(i).cells;
                objCells.item(0).setAttribute("contenteditable",false);
            }
        }

        function appendRow(numRows,table) {

            for(j=0;j<numRows;j++){
                var tbl = document.getElementById(table), // table reference
                    row = tbl.insertRow(tbl.rows.length),      // append table row
                    i;
                // insert table cells to the new row
                for (i = 0; i < tbl.rows[0].cells.length; i++) {
                    createCell(row.insertCell(i), i, 'row');
                }
            }
        }

        // function appendCol(numRows,table) {
        //     for (j=0;j<numRows;j++){
        //         var tbl = document.getElementById(table), // table reference
        //             i;
        //         // open loop for each row and append cell
        //         for (i = 0; i < tbl.rows.length; i++) {
        //             createCell(tbl.rows[i].insertCell(tbl.rows[i].cells.length), i, 'col');
        //         }
        //     }
        // }

        function appendCol(numRows, table, text){
            for(i=0;i<=numRows;i++){
                var cell = document.getElementById(table).rows[i].insertCell(-1);
                let newText = document.createTextNode(text);
                cell.appendChild(newText);
                cell.contentEditable="true" 
            }
        }

        function createCell(cell, text, style) {
            var div = document.createElement('div'), // create DIV element
                txt = document.createTextNode(text); // create text node
            div.appendChild(txt);                    // append text node to the DIV
            div.setAttribute('class', style);        // set DIV class attribute
            div.setAttribute('className', style);    // set DIV class attribute for IE (?!)
            cell.appendChild(div);
            cell.setAttribute('contenteditable', true)// append DIV to the table cell
        }

        var paramArr = [];
        

        function addParams(){
            var params='('
            for(i=0;i<paramArr.length-1;i++){
                params+= paramArr[i] + ',';
            }
            params+= paramArr[paramArr.length-1]
            
            editor.find('(')
            editor.replace(params)
            initialCode = editor.getValue();
        }

        function showParams(){
            var val = document.getElementById('paramsCheck').value;
            if(val === 'Yes'){
                document.getElementById('paramP').style.visibility = 'visible'
                document.getElementById('numParams').style.visibility = 'visible'
                document.getElementById('preC').style.visibility = 'visible'
                document.getElementById('paramBtn').style.visibility = 'visible'
                document.getElementById('testTable').style.visibility = 'visible'
                document.getElementById('sampleTable').style.visibility = 'visible'
                document.getElementById('sampleOutput').style.visibility = 'hidden'
            }
            else{
                editor.setValue(defaultVal);
                document.getElementById('paramP').style.visibility = 'hidden'
                document.getElementById('numParams').style.visibility = 'hidden'
                document.getElementById('paramBtn').style.visibility = 'hidden'
                document.getElementById('preC').style.visibility = 'hidden'
                document.getElementById('testTable').style.visibility = 'hidden'
                document.getElementById('sampleTable').style.visibility = 'hidden'
                document.getElementById('sampleOutput').style.visibility = 'visible'
            }
        }

        function askForParams(){
            var count = document.getElementById('numParams').value;
            if (count>0){
                for(i=0;i<count;i++){  
                    //adding top cell for param name
                    var nameCell = document.getElementById('names').insertCell(-1);
                    let newText = document.createTextNode("");
                    nameCell.appendChild(newText);
                    nameCell.contentEditable="true"                        
                    
                    
                    //adding bottom cell for param type
                    var dropdown = document.createElement('Select');
                    dropdown.type = "button";
                    dropdown.className = "btn";
                    dropdown.value = "test";
                    var newCell = document.getElementById('types').insertCell(-1);
                    newCell.appendChild(dropdown);
                    var option1 = document.createElement("option");
                    option1.text = "String";
                    var option2 = document.createElement("option");
                    option2.text = "Number";
                    var option3 = document.createElement("option");
                    option3.text = "Array";
                    dropdown.add(option1);
                    dropdown.add(option2);
                    dropdown.add(option3);


                }
            } 
        }

        //inserts parameters from table into code editor
        function insParam(){
            if(document.getElementById("params").rows[0].children.length == 1){
                paramArr.push("")
            }
            else{
                for(let i=1;i<document.getElementById("params").rows[0].children.length;i++){
                paramArr.push(document.getElementById("params").rows[0].children[i].innerText)
                console.log(i)
                }
            }         
            addParams();
        }

    //compiles code from editor and returns output
    function compileCode(){
        var codeText = ''
        codeText = editor.getValue();
        var callF = "console.log(myFunction(" + document.getElementById("execute").value + "));" 
        var xhr = new XMLHttpRequest();
        alert(codeText);
        alert(callF);
        xhr.open("POST", "http://virajsule.me:3000/execTeacherCode",true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.responseType = "json"
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("output").innerHTML = this.response.result;
            }
        };

        console.log(xhr.send(JSON.stringify({
            code:codeText,
            functionCall:callF
        })));
        
    }


        function iotoTables(tableNames){
            var input = document.getElementById("execute").value
            var output = document.getElementById("output").innerText
            

            if(tableNames.length==2){
                var ecell = document.getElementById("exampleTable").rows[0].insertCell(-1);
                let enewText = document.createTextNode(input);
                ecell.appendChild(enewText);
                ecell.contentEditable="true" 

                var eocell = document.getElementById("exampleTable").rows[1].insertCell(-1);
                let eonewText = document.createTextNode(output);
                eocell.appendChild(eonewText);
                eocell.contentEditable="true";

                var tcell = document.getElementById("testTable").rows[0].insertCell(-1);
                let tnewText = document.createTextNode(input);
                tcell.appendChild(tnewText);
                tcell.contentEditable="true" 

                var tocell = document.getElementById("testTable").rows[1].insertCell(-1);
                let tonewText = document.createTextNode(output);
                tocell.appendChild(tonewText);
                tocell.contentEditable="true"  
            }
            else{
                var cell = document.getElementById(tableNames[0]).rows[0].insertCell(-1);
                let newText = document.createTextNode(input);
                cell.appendChild(newText);
                cell.contentEditable="true" 

                var ocell = document.getElementById(tableNames[0]).rows[1].insertCell(-1);
                let onewText = document.createTextNode(output);
                ocell.appendChild(onewText);
                ocell.contentEditable="true" 
                // appendCol("1",tableNames[0],arr)
            }
        }

        function postAssignment(){
            var cName = 'independent';
            var aName = document.getElementById('name').value
            var pre = document.getElementById('preC').value
            var post = document.getElementById('postC').value
            var exIn =[]
            var exOut=[]
            var testIn=[]
            var testOut=[]
            var numP = document.getElementById('numParams').innerText
            var pNames=[]
            var pTypes=[]
            var language = document.getElementById('langSelect').value;
            var c = editor.getValue()

            for(i=1;i<document.getElementById("exampleTable").rows[0].length;i++){
                exIn.push(document.getElementById('exIn').cells[i].innerText)
                exOut.push(document.getElementById('exOut').cells[i].innerText)
            }

            for(i=1;i<document.getElementById("testTable").rows[0].length;i++){
                testIn.push(document.getElementById('testIn').cells[i].innerText)
                testOut.push(document.getElementById('testOut').cells[i].innerText)
            }

            // for(i=1;i<document.getElementById("params").rows[0].length;i++){
            //     pNames.push(document.getElementById('names').cells[i].innerText)
            //     pTypes.push(document.getElementById('types').cells[i].innerText)
            // }

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://virajsule.me:3000/postTeacherAssignment",true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.responseType = 'text';
            xhr.setRequestHeader('Authorization','Bearer ' + localStorage.getItem('cscToken'))
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.responseText)
                }
            };

            console.log(xhr.send(JSON.stringify({
                className:cName,
                assignmentName:aName,
                preC:pre,
                postC: post,
                exInput: exIn.toString(),
                exeOutput: exOut.toString(),
                testInput: testIn.toString(),
                testOutput: testOut.toString(),
                numParams: numP,
                // paramNames: pNames.toString(),
                // paramTypes: pTypes.toString(),
                lang: language,
                code:c
            })));

            // if(document.getElementById('paramsCheck').value === 'Yes'){
            //     var xhr = new XMLHttpRequest();
            //     xhr.open("POST", "http://3.17.16.206:3000/postParam",true);
            //     xhr.setRequestHeader("Content-Type", "application/json");
            //     console.log(xhr.send(JSON.stringify({
            //         name: n,
            //         preCondition: pre,
            //         postCondition: post,
            //         sampleTable: sampleT,
            //         testTable: testT,
            //         code:c,
            //         arr: params,
            //         sTR:sTrows,
            //         sTC:sTcols,
            //         tTR:tTrows,
            //         tTC:tTcols,
            //         teacher:localStorage.getItem('signedIn')
            //     })));
            // }
            // else{
            //     var xhr = new XMLHttpRequest();
            //     xhr.open("POST", "http://3.17.16.206:3000/postNoParam",true);
            //     xhr.setRequestHeader("Content-Type", "application/json");
            //     console.log(xhr.send(JSON.stringify({
            //         name: n,
            //         preCondition: pre,
            //         postCondition: post,
            //         sampleOutput: sampleO,
            //         code: c,
            //         teacher:localStorage.getItem('signedIn')
            //     })));
            //     }
        }
    
    </script>


    <style type="text/css" media="screen">
        #heading {
            text-align: center;
        }
        .container{
            text-align: left;
            
        }
        .x{
            display: inline-block;
        }
        #container{
            height: 400px;
            width: auto;
            white-space: nowrap;
            overflow: hidden;
            position: relative;
        }
        #editor { 
            height:  30vh;
            /* min-height: 50vh; */
            width: 700px;
            display: inline-block;
        }
        /* #exampleTable{
            visibility: hidden;
        }
        #testTable{
            visibility: hidden;
        } */
        /* #preC{
            visibility: hidden;
        } */
        .tables{
            width: fit-content;
            color: #4ABDAC;
            font-weight:bold;
            background-color: #F7B733;
            
        }
        table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 40%;
        }
        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #F7B733;
        }

        li {
            float: left;
        }

        li a {
            display: block;
            color: #4ABDAC;
            font-weight: bold;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        li a:hover {
            background-color: rgb(70, 63, 3);
        } 

        .iobtn {
            visibility: visible;
        }  

        .left-element {
            display: inline-block;
            float: left;
        }

        .right-element {
            display: inline-block;
            
        }  
    
    </style>
  </head>
  <body onload="setDefault()" bgcolor = "#4ABDAC">
    <ul>
        <li><a class="active" onclick="clickedClasses();">Classes</a></li>
        <li><a onclick="clickedPost();">Post Assignment</a></li>
        <li><a onclick="clickedCreate()">Create Class</a></li>
        <li><a onclick="clickedLogout()">Logout</a></li>
      </ul>
    <h1 id="heading">Post Assignment</h1>
    <!-- <table>
        <tr><td><div contenteditable>I'm editable</div></td>
        <td><div contenteditable>I'm also editable</div></td></tr>
    </table> -->
    

    <div class='container'>
        <h2 class="x">Assignment Name: </h2>
        <input class='x' type="TEXT" id="name" size="100">
    </div>

    <div class='container'>
        <h2 class="x">Precondition: </h2>
        <input class='x ' type="TEXT" id="preC" size="100">
    </div>

    <div class='container'>
        <h2 class="x">Postcondition: </h2>
        <input class='x ' type="TEXT" id="postC" size="100">
    </div>

    <!-- <div class='container'>
        <h2 class="x">Output:</h2>
        <input class='x' type="TEXT" id="sampleOutput" size="100">
    </div> -->

    <div class='container'>
        <div class="left-element">
            <h2 class="x">Example Input/Output:   </h2>
        </div>

        <div class="right-element">
            <table class ='tables' id="exampleTable">
                <tr id="exIn"><td><div>Input:</div>
                <tr id="exOut"><td><div></div>Output:</div>
            </table>
            <br>
            <button onclick="appendCol(1,'exampleTable','')">Add Instance</button>
        </div>
        
        
    </div>
    <br>
    <br>
    <br>


    <!-- <div class='container'>
        <h2 class="x">Sample Output (Students Will See This):   </h2>
        <input class='x' type="TEXT" id="sampleOutput" size="100">
    </div> -->

    <div class='container'>
        <div class="left-element">
            <h2 class="x">Test Input/Output:   </h2>
        </div>
        <div class="right-element">
            <table class ='tables' id="testTable" >
                <tr id="testIn"><td><div>Input:</div>
                <tr id="testOut"><td><div></div>Output:</div>
            </table>
            <br>
            <button onclick="appendCol(1,'testTable','')">Add Instance</button>
        </div>
    </div>

    <!-- <div class='container'>
        <h2 class="x">Test Output (Students Will Not See This):   </h2>
        <input class='x' type="TEXT" id="testOutput" size="100">
    </div> -->

    <div class='container'>
        <h2 class="x">Parameters: </h2>
        <p id='paramP' class="x">Number of Parameters: </p>
        <input class='x' type="TEXT" id="numParams" size="3" value="0">
        <button id ='paramBtn' class="x" onclick="askForParams()">Name Parameters</button>
        <table id="params" class="tables">
            <tr id="names"><td><div>Parameter  Names:</div>
            <tr id="types"><td><div>Parameter  Types:</div>
        </table>

        <!-- <table id="paramTypes" class="tables">
            <tr id="types"><td><div>Parameter  Types:</div>
        </table> -->
    </div>


    <br>
    <button onclick="insParam()">Initialize Program</button>
    <select onchange="changeLang()" id='langSelect'>
        <option value="Javascript">Javascript</option>
        <option value="Python">Python</option>
    </select>

    <br>
    <br>

    <div id='container'>
        <div id='editor'>function myFunction(){
    





}
        </div>
        <br>
        <br>
        <div class="form-group">
            <p>Execute: </p>
            <span id="functionName">myFunction(</span>
            <input  id="execute" class="form-field" type="text" placeholder="Insert Parameters">
            <span>)</span>
            <button onclick="compileCode()">Compile</button>
            <br>
            <p id="output">Output:</p>
            <button class="iobtn" id="iotoex" onclick="iotoTables(['exampleTable'])">Add Input/Output to Example Table</button>
            <button class="iobtn" id="iototest" onclick="iotoTables(['testTable'])">Add Input/Output to Test Table</button>
            <button class="iobtn" id="iotoboth" onclick="iotoTables(['exampleTable','testTable'])">Add Input/Output to Both Tables</button>
        </div>
    </div>
    

    <br>

    <!-- <button onclick="compileCode()">Compile</button>
    <br>
    <p id="output">Output:</p>
    <br> -->
    <button onclick="postAssignment()">Post Assignment</button>

    <script>
        var editor = ace.edit('editor');
        editor.setTheme("ace/theme/dracula");
        editor.session.setMode("ace/mode/javascript");        
        // editor.setReadOnly(true);
        // editor.row(1).setReadOnly(false);
        editor.setReadOnly(false);
    </script>
    
  </body>
</html>